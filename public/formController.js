angular
  .module('app', ['ui.utils.masks'])
  .controller('formController', [
    '$scope',
    '$http',
    function ($scope, $http) {

      var countyData = [
        'Baldwin County',
        'Calhoun County',
        'Cullman County',
        'DeKalb County',
        'Elmore County',
        'Etowah County',
        'Houston County',
        'Jefferson County',
        'Lauderdale County',
        'Lee County',
        'Limestone County',
        'Madison County',
        'Marshall County',
        'Mobile County',
        'Montgomery County',
        'Morgan County',
        'St. Clair County',
        'Shelby County',
        'Talladega County',
        'Tuscaloosa County',
        'Walker County',
        'Anchorage Municipality',
        'Fairbanks North Star Borough',
        'Matanuska-Susitna Borough',
        'Apache County',
        'Cochise County',
        'Coconino County',
        'Maricopa County',
        'Mohave County',
        'Navajo County',
        'Pima County',
        'Pinal County',
        'Yavapai County',
        'Yuma County',
        'Benton County',
        'Craighead County',
        'Faulkner County',
        'Garland County',
        'Lonoke County',
        'Pulaski County',
        'Saline County',
        'Sebastian County',
        'Washington County',
        'White County',
        'Alameda County',
        'Butte County',
        'Contra Costa County',
        'El Dorado County',
        'Fresno County',
        'Humboldt County',
        'Imperial County',
        'Kern County',
        'Kings County',
        'Lake County',
        'Los Angeles County',
        'Madera County',
        'Marin County',
        'Mendocino County',
        'Merced County',
        'Monterey County',
        'Napa County',
        'Nevada County',
        'Orange County',
        'Placer County',
        'Riverside County',
        'Sacramento County',
        'San Bernardino County',
        'San Diego County',
        'San Francisco County',
        'San Joaquin County',
        'San Luis Obispo County',
        'San Mateo County',
        'Santa Barbara County',
        'Santa Clara County',
        'Santa Cruz County',
        'Shasta County',
        'Solano County',
        'Sonoma County',
        'Stanislaus County',
        'Sutter County',
        'Tulare County',
        'Ventura County',
        'Yolo County',
        'Yuba County',
        'Adams County',
        'Arapahoe County',
        'Boulder County',
        'Broomfield County',
        'Denver County',
        'Douglas County',
        'El Paso County',
        'Larimer County',
        'Mesa County',
        'Pueblo County',
        'Weld County',
        'Fairfield County',
        'Hartford County',
        'Litchfield County',
        'Middlesex County',
        'New Haven County',
        'New London County',
        'Tolland County',
        'Windham County',
        'Kent County',
        'New Castle County',
        'Sussex County',
        'District of Columbia',
        'Alachua County',
        'Bay County',
        'Brevard County',
        'Broward County',
        'Charlotte County',
        'Citrus County',
        'Clay County',
        'Collier County',
        'Columbia County',
        'Duval County',
        'Escambia County',
        'Flagler County',
        'Hernando County',
        'Highlands County',
        'Hillsborough County',
        'Indian River County',
        'Leon County',
        'Manatee County',
        'Marion County',
        'Martin County',
        'Miami-Dade County',
        'Monroe County',
        'Nassau County',
        'Okaloosa County',
        'Osceola County',
        'Palm Beach County',
        'Pasco County',
        'Pinellas County',
        'Polk County',
        'Putnam County',
        'St. Johns County',
        'St. Lucie County',
        'Santa Rosa County',
        'Sarasota County',
        'Seminole County',
        'Sumter County',
        'Volusia County',
        'Barrow County',
        'Bartow County',
        'Bibb County',
        'Bulloch County',
        'Carroll County',
        'Catoosa County',
        'Chatham County',
        'Cherokee County',
        'Clarke County',
        'Clayton County',
        'Cobb County',
        'Coweta County',
        'Dougherty County',
        'Fayette County',
        'Floyd County',
        'Forsyth County',
        'Fulton County',
        'Glynn County',
        'Gwinnett County',
        'Hall County',
        'Henry County',
        'Liberty County',
        'Lowndes County',
        'Muscogee County',
        'Newton County',
        'Paulding County',
        'Richmond County',
        'Rockdale County',
        'Troup County',
        'Walton County',
        'Whitfield County',
        'Hawaii County',
        'Honolulu County',
        'Kauai County',
        'Maui County',
        'Ada County',
        'Bannock County',
        'Bonneville County',
        'Canyon County',
        'Kootenai County',
        'Twin Falls County',
        'Champaign County',
        'Cook County',
        'DuPage County',
        'Kane County',
        'Kankakee County',
        'Kendall County',
        'LaSalle County',
        'McHenry County',
        'McLean County',
        'Macon County',
        'Peoria County',
        'Rock Island County',
        'Sangamon County',
        'Tazewell County',
        'Vermilion County',
        'Will County',
        'Williamson County',
        'Winnebago County',
        'Allen County',
        'Bartholomew County',
        'Clark County',
        'Delaware County',
        'Elkhart County',
        'Grant County',
        'Hamilton County',
        'Hancock County',
        'Hendricks County',
        'Howard County',
        'Johnson County',
        'Kosciusko County',
        'LaPorte County',
        'Porter County',
        'St. Joseph County',
        'Tippecanoe County',
        'Vanderburgh County',
        'Vigo County',
        'Wayne County',
        'Black Hawk County',
        'Dallas County',
        'Dubuque County',
        'Linn County',
        'Pottawattamie County',
        'Scott County',
        'Story County',
        'Woodbury County',
        'Butler County',
        'Leavenworth County',
        'Riley County',
        'Sedgwick County',
        'Shawnee County',
        'Wyandotte County',
        'Boone County',
        'Bullitt County',
        'Campbell County',
        'Christian County',
        'Daviess County',
        'Hardin County',
        'Kenton County',
        'McCracken County',
        'Pike County',
        'Warren County',
        'Ascension Parish',
        'Bossier Parish',
        'Caddo Parish',
        'Calcasieu Parish',
        'East Baton Rouge Parish',
        'Iberia Parish',
        'Jefferson Parish',
        'Lafayette Parish',
        'Lafourche Parish',
        'Livingston Parish',
        'Orleans Parish',
        'Ouachita Parish',
        'Rapides Parish',
        'St. Landry Parish',
        'St. Tammany Parish',
        'Tangipahoa Parish',
        'Terrebonne Parish',
        'Androscoggin County',
        'Aroostook County',
        'Cumberland County',
        'Kennebec County',
        'Penobscot County',
        'York County',
        'Allegany County',
        'Anne Arundel County',
        'Baltimore County',
        'Calvert County',
        'Cecil County',
        'Charles County',
        'Frederick County',
        'Harford County',
        'Prince Georges County',
        'St. Marys County',
        'Wicomico County',
        'Baltimore city',
        'Barnstable County',
        'Berkshire County',
        'Bristol County',
        'Essex County',
        'Franklin County',
        'Hampden County',
        'Hampshire County',
        'Norfolk County',
        'Plymouth County',
        'Suffolk County',
        'Worcester County',
        'Allegan County',
        'Berrien County',
        'Clinton County',
        'Eaton County',
        'Genesee County',
        'Grand Traverse County',
        'Ingham County',
        'Isabella County',
        'Jackson County',
        'Kalamazoo County',
        'Lapeer County',
        'Lenawee County',
        'Livingston County',
        'Macomb County',
        'Marquette County',
        'Midland County',
        'Muskegon County',
        'Oakland County',
        'Ottawa County',
        'Saginaw County',
        'Shiawassee County',
        'Van Buren County',
        'Washtenaw County',
        'Anoka County',
        'Blue Earth County',
        'Carver County',
        'Dakota County',
        'Hennepin County',
        'Olmsted County',
        'Ramsey County',
        'Rice County',
        'St. Louis County',
        'Sherburne County',
        'Stearns County',
        'Wright County',
        'DeSoto County',
        'Forrest County',
        'Harrison County',
        'Hinds County',
        'Jones County',
        'Rankin County',
        'Buchanan County',
        'Cape Girardeau County',
        'Cass County',
        'Cole County',
        'Greene County',
        'Jasper County',
        'Platte County',
        'St. Charles County',
        'St. Francois County',
        'St. Louis city',
        'Cascade County',
        'Flathead County',
        'Gallatin County',
        'Lewis and Clark County',
        'Missoula County',
        'Yellowstone County',
        'Lancaster County',
        'Sarpy County',
        'Washoe County',
        'Cheshire County',
        'Grafton County',
        'Merrimack County',
        'Rockingham County',
        'Strafford County',
        'Atlantic County',
        'Bergen County',
        'Burlington County',
        'Camden County',
        'Cape May County',
        'Gloucester County',
        'Hudson County',
        'Hunterdon County',
        'Mercer County',
        'Monmouth County',
        'Morris County',
        'Ocean County',
        'Passaic County',
        'Salem County',
        'Somerset County',
        'Union County',
        'Bernalillo County',
        'Chaves County',
        'Doña Ana County',
        'Lea County',
        'McKinley County',
        'Otero County',
        'Sandoval County',
        'San Juan County',
        'Santa Fe County',
        'Valencia County',
        'Albany County',
        'Bronx County',
        'Broome County',
        'Cattaraugus County',
        'Cayuga County',
        'Chautauqua County',
        'Chemung County',
        'Dutchess County',
        'Erie County',
        'New York County',
        'Niagara County',
        'Oneida County',
        'Onondaga County',
        'Ontario County',
        'Oswego County',
        'Queens County',
        'Rensselaer County',
        'Rockland County',
        'St. Lawrence County',
        'Saratoga County',
        'Schenectady County',
        'Steuben County',
        'Sullivan County',
        'Tompkins County',
        'Ulster County',
        'Westchester County',
        'Alamance County',
        'Brunswick County',
        'Buncombe County',
        'Burke County',
        'Cabarrus County',
        'Caldwell County',
        'Carteret County',
        'Catawba County',
        'Cleveland County',
        'Craven County',
        'Davidson County',
        'Durham County',
        'Gaston County',
        'Guilford County',
        'Harnett County',
        'Henderson County',
        'Iredell County',
        'Johnston County',
        'Lincoln County',
        'Mecklenburg County',
        'Moore County',
        'Nash County',
        'New Hanover County',
        'Onslow County',
        'Pitt County',
        'Randolph County',
        'Robeson County',
        'Rowan County',
        'Rutherford County',
        'Surry County',
        'Wake County',
        'Wilkes County',
        'Wilson County',
        'Burleigh County',
        'Grand Forks County',
        'Ward County',
        'Ashtabula County',
        'Athens County',
        'Belmont County',
        'Clermont County',
        'Columbiana County',
        'Cuyahoga County',
        'Geauga County',
        'Licking County',
        'Lorain County',
        'Lucas County',
        'Mahoning County',
        'Medina County',
        'Miami County',
        'Muskingum County',
        'Portage County',
        'Richland County',
        'Ross County',
        'Scioto County',
        'Stark County',
        'Summit County',
        'Trumbull County',
        'Tuscarawas County',
        'Wood County',
        'Canadian County',
        'Comanche County',
        'Creek County',
        'Muskogee County',
        'Oklahoma County',
        'Payne County',
        'Pottawatomie County',
        'Rogers County',
        'Tulsa County',
        'Wagoner County',
        'Clackamas County',
        'Deschutes County',
        'Josephine County',
        'Klamath County',
        'Lane County',
        'Multnomah County',
        'Umatilla County',
        'Yamhill County',
        'Allegheny County',
        'Armstrong County',
        'Beaver County',
        'Berks County',
        'Blair County',
        'Bucks County',
        'Cambria County',
        'Carbon County',
        'Centre County',
        'Chester County',
        'Clearfield County',
        'Crawford County',
        'Dauphin County',
        'Indiana County',
        'Lackawanna County',
        'Lawrence County',
        'Lebanon County',
        'Lehigh County',
        'Luzerne County',
        'Lycoming County',
        'Northampton County',
        'Northumberland County',
        'Philadelphia County',
        'Schuylkill County',
        'Westmoreland County',
        'Newport County',
        'Providence County',
        'Aiken County',
        'Anderson County',
        'Beaufort County',
        'Berkeley County',
        'Charleston County',
        'Darlington County',
        'Dorchester County',
        'Florence County',
        'Greenville County',
        'Greenwood County',
        'Horry County',
        'Laurens County',
        'Lexington County',
        'Oconee County',
        'Orangeburg County',
        'Pickens County',
        'Spartanburg County',
        'Minnehaha County',
        'Pennington County',
        'Blount County',
        'Bradley County',
        'Knox County',
        'Maury County',
        'Robertson County',
        'Sevier County',
        'Sumner County',
        'Angelina County',
        'Bastrop County',
        'Bell County',
        'Bexar County',
        'Bowie County',
        'Brazoria County',
        'Brazos County',
        'Cameron County',
        'Collin County',
        'Comal County',
        'Coryell County',
        'Denton County',
        'Ector County',
        'Ellis County',
        'Fort Bend County',
        'Galveston County',
        'Grayson County',
        'Gregg County',
        'Guadalupe County',
        'Harris County',
        'Hays County',
        'Hidalgo County',
        'Hunt County',
        'Kaufman County',
        'Lubbock County',
        'McLennan County',
        'Nacogdoches County',
        'Nueces County',
        'Parker County',
        'Potter County',
        'Randall County',
        'Rockwall County',
        'San Patricio County',
        'Smith County',
        'Tarrant County',
        'Taylor County',
        'Tom Green County',
        'Travis County',
        'Victoria County',
        'Webb County',
        'Wichita County',
        'Cache County',
        'Davis County',
        'Salt Lake County',
        'Utah County',
        'Weber County',
        'Chittenden County',
        'Albemarle County',
        'Arlington County',
        'Augusta County',
        'Bedford County',
        'Chesterfield County',
        'Fairfax County',
        'Fauquier County',
        'Hanover County',
        'Henrico County',
        'James City County',
        'Loudoun County',
        'Prince William County',
        'Roanoke County',
        'Spotsylvania County',
        'Stafford County',
        'Alexandria city',
        'Chesapeake city',
        'Hampton city',
        'Lynchburg city',
        'Newport News city',
        'Norfolk city',
        'Portsmouth city',
        'Richmond city',
        'Roanoke city',
        'Suffolk city',
        'Virginia Beach city',
        'Chelan County',
        'Clallam County',
        'Cowlitz County',
        'Grays Harbor County',
        'Island County',
        'King County',
        'Kitsap County',
        'Lewis County',
        'Pierce County',
        'Skagit County',
        'Snohomish County',
        'Spokane County',
        'Thurston County',
        'Whatcom County',
        'Yakima County',
        'Cabell County',
        'Kanawha County',
        'Monongalia County',
        'Raleigh County',
        'Brown County',
        'Dane County',
        'Dodge County',
        'Eau Claire County',
        'Fond du Lac County',
        'Kenosha County',
        'La Crosse County',
        'Manitowoc County',
        'Marathon County',
        'Milwaukee County',
        'Outagamie County',
        'Ozaukee County',
        'Racine County',
        'Rock County',
        'St. Croix County',
        'Sheboygan County',
        'Walworth County',
        'Waukesha County',
        'Laramie County',
        'Natrona County'
      ];

      $scope.countyData = countyData;
      console.log($scope);

      $scope.getCommerceData = function () {
        $scope.hasData = true;
        let formData = $scope.formData;

        // create object that translates

        $http
          .post('/userSubmission', formData)
          .then((response) => {
            console.log("resposne from server and stuff", response);

            $scope.userIncomeBucket = response.data.userIncomeBucket;
            $scope.userPercentile = response.data.userPercentile;

            // turns object into array of object data elements
            var data = d3.entries(response.data.modifiedBuckets);

            var margin = {
              top: 40,
              right: 20,
              bottom: 30,
              left: 40
            }
            var width = parseInt(d3.select(".container").style("width")) - margin.right;
            var height = 300;

            var formatPercent = d3.format(".0%");

            var x = d3
              .scale
              .ordinal()
              .rangeRoundBands([
                0, width
              ], .1);

            var y = d3
              .scale
              .linear()
              .range([height, 0]);

            var xAxis = d3
              .svg
              .axis()
              .scale(x)
              .orient("bottom")

            var yAxis = d3
              .svg
              .axis()
              .scale(y)
              .orient("left")
              .tickFormat(formatPercent)

            var tip = d3
              .tip()
              .attr('class', 'd3-tip')
              .offset([-5, 0])
              .html(function (d) {
                return "<strong>value:</strong> <span style='color:red'>" + d.value + "</span>";
              })

            var svg = d3
              .select("div")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            svg.call(tip);

            x.domain(data.map(function (d) {
              return d.key;
            }));
            y.domain([
              0,
              d3.max(data, function (d) {
                return d.value;
              })
            ]);

            svg
              .append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis)

            svg
              .append("g")
              .attr("class", "y axis")
              .style("font-size", "15px") //To change the font size of texts
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", "1em")
              .style("text-anchor", "end")
              .text("value")

            svg
              .selectAll(".bar")
              .data(data)
              .enter()
              .append("rect")
              .attr("class", "bar")
              .attr("x", function (d) {
                return x(d.key);
              })
              .attr("width", x.rangeBand())
              .transition() //animation
              .delay(function (d, i) { // more animation stuff
                return i * 50;
              })
              .attr("y", function (d) {
                return y(d.value);
              })
              .attr("height", function (d) {
                return height - y(d.value);
              })
              .filter(function (d) {
                console.log("does this fire?");
                return d.key === response.data.userIncomeBucket;
              })
              .style('fill', 'steelblue')
              .on('mouseover', tip.show)
              .on('mouseout', tip.hide)

            function type(d) {
              d.value = +d.value;
              return d;
            }

          })
      }
    }
  ]);